{"version":3,"sources":["json-webworker-pages/ws.worker.js"],"names":["host","ws","WebSocket","waitQueue","wsOpened","sendWaitingQueue","send","shift","length","onopen","postMessage","onmessage","message","data","JSON","parse","console","log","op","rtt","Date","getTime","Number","args","type","val","stringify","push"],"mappings":";AAAA,IAAIA,EAAgE,sCAChEC,EAAK,IAAIC,UAAaF,GAAAA,OAAAA,EAA1B,UAEMG,EAAY,GACdC,GAAW,EAETC,EAAmB,WACpB,GACDJ,EAAGK,KAAKH,EAAUI,eACXJ,EAAUK,OAAS,IAG9BP,EAAGQ,OAAS,WACVL,GAAW,EACXM,YAAY,WAOdT,EAAGU,UAAY,SAAUC,GACjBC,IAAAA,EAAOC,KAAKC,MAAMH,EAAQC,MAG5BA,GAFJG,QAAQC,IAAI,UAAWJ,GAEP,SAAZA,EAAKK,GAAe,CAChBC,IAAAA,GAAM,IAAIC,MAAOC,UAAYC,OAAOT,EAAKU,KAAK,IAGpD,OAFAP,QAAQC,IAAgBE,eAAAA,OAAAA,EAAxB,YACAT,YAAY,CAAEc,KAAM,MAAOC,IAAKN,IAIlCT,YAAYG,IAGdF,UAAY,SAAc,GAAXE,IAAAA,EAAAA,EAAAA,KACRT,GAKLH,EAAGK,KAAKQ,KAAKY,UAAU,CAAER,GAAI,OAAQK,KAAK,EAAC,IAAIH,MAAOC,cACtDpB,EAAGK,KAAKQ,KAAKY,UAAU,CAAER,GAAI,QAASK,KAAK,EAAC,IAAIH,MAAOC,eALrDlB,EAAUwB,KAAKd","file":"ws.worker.3907e3c8.js","sourceRoot":"../web","sourcesContent":["var host = process.env.NODE_ENV === 'dev' ? 'ws://localhost:3000' : 'wss://ws-js-pb-server.herokuapp.com';\nvar ws = new WebSocket(`${host}/json`);\n\nconst waitQueue = [];\nlet wsOpened = false;\n\nconst sendWaitingQueue = () => {\n  do {\n    ws.send(waitQueue.shift());\n  } while (waitQueue.length < 1);\n};\n\nws.onopen = () => {\n  wsOpened = true;\n  postMessage('opened');\n  // sendWaitingQueue();\n};\n\n/**\n * Use arrayBuffer\n */\nws.onmessage = function (message) {\n  const data = JSON.parse(message.data);\n  console.log('data = ', data);\n\n  if (data.op === 'pong') {\n    const rtt = new Date().getTime() - Number(data.args[0]);\n    console.log(`Pong --> ${rtt}ms`);\n    postMessage({ type: 'rtt', val: rtt });\n    return;\n  };\n\n  postMessage(data);\n};\n\nonmessage = ({ data }) => {\n  if (!wsOpened) {\n    waitQueue.push(data);\n    return;\n  }\n\n  ws.send(JSON.stringify({ op: 'ping', args:[new Date().getTime()] }));\n  ws.send(JSON.stringify({ op: 'topic', args:[new Date().getTime()] }));\n};\n"]}